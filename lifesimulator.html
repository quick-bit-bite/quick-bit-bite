<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Life Simulator</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f0f0;
      color: #333;
      overflow: hidden;
    }
    #game-container {
      display: flex;
      flex-direction: row;
      height: 100vh;
    }
    #left-panel {
      width: 350px;
      background: #fff;
      border-right: 2px solid #ccc;
      padding: 15px;
      box-sizing: border-box;
      overflow-y: auto;
    }
    #header {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 10px;
      text-align: center;
    }
    #status-panel {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 15px;
      background: #fafafa;
    }
    #game-log {
      height: 50vh;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
      background: #fff;
      margin-bottom: 15px;
    }
    #control-panel {
      text-align: center;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 1em;
      cursor: pointer;
    }
    #right-panel {
      flex: 1;
      position: relative;
      background: #e9ecef;
    }
    #life-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #fff;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <!-- Left panel for text and controls -->
    <div id="left-panel">
      <div id="header">Life Simulator</div>
      <div id="status-panel">
        <p><strong>Name:</strong> <span id="playerName">-</span></p>
        <p><strong>Age:</strong> <span id="playerAge">0</span></p>
        <p><strong>Health:</strong> <span id="playerHealth">100</span></p>
        <p><strong>Happiness:</strong> <span id="playerHappiness">50</span></p>
        <p><strong>Wealth:</strong> $<span id="playerWealth">0</span></p>
        <p><strong>Education:</strong> <span id="playerEducation">None</span></p>
        <p><strong>Career:</strong> <span id="playerCareer">None</span></p>
      </div>
      <div id="game-log">
        <p>Welcome to your life! Press "New Game" to begin your journey.</p>
      </div>
      <div id="control-panel">
        <button id="newGameBtn">New Game</button>
        <button id="nextYearBtn" style="display:none;">Next Year</button>
      </div>
    </div>
    <!-- Right panel for graphics -->
    <div id="right-panel">
      <canvas id="life-canvas"></canvas>
    </div>
  </div>

  <script>
    // Game variables and player object
    let player = {
      name: "",
      age: 0,
      health: 100,
      happiness: 50,
      wealth: 0,
      education: "None",
      career: "None",
      history: []  // to record events for the timeline
    };

    let gameOver = false;
    let pendingChoice = null;

    // DOM Elements
    const playerNameEl = document.getElementById("playerName");
    const playerAgeEl = document.getElementById("playerAge");
    const playerHealthEl = document.getElementById("playerHealth");
    const playerHappinessEl = document.getElementById("playerHappiness");
    const playerWealthEl = document.getElementById("playerWealth");
    const playerEducationEl = document.getElementById("playerEducation");
    const playerCareerEl = document.getElementById("playerCareer");
    const gameLog = document.getElementById("game-log");
    const newGameBtn = document.getElementById("newGameBtn");
    const nextYearBtn = document.getElementById("nextYearBtn");
    const canvas = document.getElementById("life-canvas");
    const ctx = canvas.getContext("2d");

    // Resize canvas to fill its container
    function resizeCanvas() {
      canvas.width = canvas.parentElement.clientWidth;
      canvas.height = canvas.parentElement.clientHeight;
      updateCanvas();
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Utility: add message to game log
    function addLog(message) {
      const p = document.createElement("p");
      p.innerHTML = message;
      gameLog.appendChild(p);
      gameLog.scrollTop = gameLog.scrollHeight;
    }

    // Utility: update player status panel
    function updateStatus() {
      playerNameEl.textContent = player.name;
      playerAgeEl.textContent = player.age;
      playerHealthEl.textContent = Math.max(0, player.health);
      playerHappinessEl.textContent = player.happiness;
      playerWealthEl.textContent = player.wealth;
      playerEducationEl.textContent = player.education;
      playerCareerEl.textContent = player.career;
    }

    // Update canvas timeline drawing (each life event as a dot on timeline)
    function updateCanvas() {
      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Draw timeline line at the bottom
      let margin = 40;
      let lineY = canvas.height - margin;
      ctx.beginPath();
      ctx.moveTo(margin, lineY);
      ctx.lineTo(canvas.width - margin, lineY);
      ctx.strokeStyle = "#333";
      ctx.lineWidth = 2;
      ctx.stroke();

      // Plot each event as a dot along the timeline based on age
      let maxAge = Math.max(80, player.age);
      player.history.forEach(event => {
        let x = margin + ((canvas.width - 2 * margin) * event.age / maxAge);
        let y = lineY;
        ctx.beginPath();
        ctx.arc(x, y, 6, 0, Math.PI * 2);
        // Color by type of event:
        let color = "#888";
        if (event.type === "education") color = "#007bff";
        else if (event.type === "career") color = "#28a745";
        else if (event.type === "relationship") color = "#dc3545";
        else if (event.type === "health") color = "#ffc107";
        else if (event.type === "random") color = "#6f42c1";
        ctx.fillStyle = color;
        ctx.fill();
      });
    }

    // Start a new game: reset variables and prompt for name
    function startGame() {
      player = {
        name: prompt("What is your name?") || "Anonymous",
        age: 0,
        health: 100,
        happiness: 50,
        wealth: 0,
        education: "None",
        career: "None",
        history: []
      };
      gameOver = false;
      pendingChoice = null;
      gameLog.innerHTML = "";
      addLog(`Welcome, ${player.name}! Your life begins...`);
      updateStatus();
      updateCanvas();
      newGameBtn.style.display = "none";
      nextYearBtn.style.display = "inline-block";
    }

    // Simulate one year of life
    function simulateYear() {
      if (gameOver || pendingChoice) return; // wait if a decision is pending

      player.age++;
      addLog(`<strong>Age ${player.age}:</strong> A new year of life unfolds.`);

      // Childhood events: education and family support
      if (player.age < 18) {
        simulateChildhood();
      } 
      // Adulthood: career, relationships, and random life events
      else {
        simulateAdultLife();
      }
      updateStatus();
      updateCanvas();
      checkGameOver();
    }

    // Simulate events in childhood and adolescence
    function simulateChildhood() {
      // Every year until 6 is family/nurturing
      if (player.age <= 6) {
        addLog("You spent your early years playing and learning from your family.");
        player.happiness += 2;
      } 
      // Ages 7 to 17: school and growing up
      else {
        let schoolSuccess = Math.random();
        if (schoolSuccess > 0.5) {
          addLog("You did well in school, learning and making friends.");
          player.happiness += 3;
          // Chance to start education path early
          if (player.education === "None") {
            player.education = "High School";
            addLog("You graduated from elementary school and started high school.");
            player.history.push({ age: player.age, type: "education", note: "Started High School" });
          }
        } else {
          addLog("School was challenging this year. You struggled a bit.");
          player.happiness -= 2;
          player.health -= 1;
        }
      }
    }

    // Simulate events in adulthood
    function simulateAdultLife() {
      // Major milestone: at age 18, choose to pursue higher education or work
      if (player.age === 18 && player.education === "High School") {
        pendingChoice = "postHighSchool";
        addLog("You are now 18. Do you want to go to college or start working?");
        showChoiceButtons(["Go to College", "Start Working"], (choice) => {
          if (choice === "Go to College") {
            player.education = "College";
            player.wealth -= 10000; // tuition cost
            addLog("You enrolled in college. Expect a few lean years financially, but knowledge is power.");
            player.history.push({ age: player.age, type: "education", note: "Enrolled in College" });
          } else {
            player.career = "Entry Level Job";
            player.wealth += 5000;
            addLog("You started working right away. Money starts coming in, but life lessons come slowly.");
            player.history.push({ age: player.age, type: "career", note: "Started Work" });
          }
          updateStatus();
          pendingChoice = null;
        });
        return;
      }
      // If in college, at age 22 graduate
      if (player.age === 22 && player.education === "College") {
        player.education = "College Graduate";
        addLog("You graduated from college. A world of opportunities now lies ahead.");
        player.history.push({ age: player.age, type: "education", note: "Graduated College" });
      }

      // Random life events each year
      let eventRoll = Math.random();
      if (eventRoll < 0.25) {
        // Health event
        let severity = Math.random();
        if (severity > 0.7) {
          addLog("You suffered a serious illness this year.");
          player.health -= 20;
          player.happiness -= 10;
        } else {
          addLog("A minor health scare made you take better care of yourself.");
          player.health -= 5;
          player.happiness -= 2;
        }
        player.history.push({ age: player.age, type: "health", note: "Health event" });
      } else if (eventRoll < 0.50) {
        // Career event: promotion/demotion
        if (player.career === "None") {
          player.career = "Junior Employee";
          addLog("You got your first job and started your career journey.");
          player.wealth += 3000;
          player.history.push({ age: player.age, type: "career", note: "Started Career" });
        } else {
          if (Math.random() > 0.5) {
            addLog("You got a promotion at work!");
            player.wealth += 5000;
            player.happiness += 5;
            player.career = "Senior " + player.career;
            player.history.push({ age: player.age, type: "career", note: "Promotion" });
          } else {
            addLog("Work was stressful. You faced setbacks at your job.");
            player.wealth -= 2000;
            player.happiness -= 5;
            player.history.push({ age: player.age, type: "career", note: "Work setback" });
          }
        }
      } else if (eventRoll < 0.75) {
        // Relationship event
        if (Math.random() > 0.5) {
          addLog("You met someone special. Love is in the air.");
          player.happiness += 10;
          player.history.push({ age: player.age, type: "relationship", note: "Met someone" });
        } else {
          addLog("A friendship was tested this year, but you learned valuable lessons.");
          player.happiness += 3;
          player.history.push({ age: player.age, type: "relationship", note: "Friendship tested" });
        }
      } else {
        // Random luck event
        let luck = Math.random();
        if (luck > 0.5) {
          addLog("Good fortune smiled on you—an unexpected windfall boosted your finances!");
          player.wealth += 10000;
          player.happiness += 7;
        } else {
          addLog("A stroke of bad luck cost you dearly this year.");
          player.wealth -= 5000;
          player.happiness -= 7;
        }
        player.history.push({ age: player.age, type: "random", note: "Luck event" });
      }
    }

    // Check if game is over (age or health conditions)
    function checkGameOver() {
      if (player.health <= 0 || player.age >= 80) {
        addLog(`<strong>Game Over.</strong> ${player.name}'s life ended at age ${player.age}.`);
        nextYearBtn.style.display = "none";
        newGameBtn.style.display = "inline-block";
        gameOver = true;
      }
    }

    // Show decision buttons for a pending choice
    function showChoiceButtons(options, callback) {
      // Clear any existing buttons from control panel
      const controlPanel = document.getElementById("control-panel");
      controlPanel.innerHTML = "";
      options.forEach(option => {
        const btn = document.createElement("button");
        btn.textContent = option;
        btn.addEventListener("click", () => {
          callback(option);
          // Restore Next Year button
          controlPanel.innerHTML = "";
          controlPanel.appendChild(nextYearBtn);
        });
        controlPanel.appendChild(btn);
      });
    }

    // Event listeners
    newGameBtn.addEventListener("click", startGame);
    nextYearBtn.addEventListener("click", simulateYear);

    // Optionally, allow advancing with Enter key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !pendingChoice && !gameOver) {
        simulateYear();
      }
    });
  </script>
</body>
</html>
